[{"id":"ba98b526.2cedf8","type":"tab","label":"Salle de Classe","disabled":false,"info":""},{"id":"16883ec7.5e17a1","type":"tab","label":"Voltage Douilles","disabled":false,"info":""},{"id":"5b8c2051.dac96","type":"tab","label":"PASCALINE","disabled":true,"info":""},{"id":"dad18347.47653","type":"tab","label":"ECHO","disabled":true,"info":""},{"id":"b16f90ed.89548","type":"tab","label":"CONDUCT","disabled":false,"info":"Analyse de la conductivité thermique.\n\nLecture des données du produit Pierron MT33552\n\nFortmat des données :\n\njson \n\" {\n    'T1' : temp1,\n    'T2' : temp2,\n    'T3' : temp3, \n    ...\n}\"\n\nSoit par mqtt, soit par usb"},{"id":"fa5172be.4a803","type":"tab","label":"Scanner","disabled":true,"info":""},{"id":"131fa4e0.8bfc2b","type":"tab","label":"System","disabled":false,"info":""},{"id":"dbf47c6d.710ab","type":"tab","label":"Horloge","disabled":false,"info":"\n\n"},{"id":"5fb70335.88a18c","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"9e82fc95.3172e","type":"subflow","name":"Voltmetre Mesura 2 DC","info":"Un Voltmetre Mesura 2 en mode continue.\n\nen entrée : MQTT ou USB\n\nen sortie : Text, gauge, Graphe ou ...","in":[{"x":60,"y":100,"wires":[{"id":"a4f68b06.85b778"}]}],"out":[{"x":1060,"y":100,"wires":[{"id":"a5df6c71.00d48","port":0}]}],"inputLabels":["A mqtt or serial node"],"outputLabels":["Tension"]},{"id":"173a36e.62101c9","type":"subflow","name":"Voltmetre Mesura 2 AC/DC","info":"Un Voltmetre Mesura 2 en mode alternatif.\n\nen entrée : MQTT ou USB\n\nen sortie : Text, gauge, Graphe ou ...","in":[{"x":60,"y":140,"wires":[{"id":"c0b70de.0909bf"}]}],"out":[{"x":1060,"y":140,"wires":[{"id":"92f3cadc.9e61f8","port":0}]}]},{"id":"24caa50b.e874ba","type":"subflow","name":"NTP<=>RTC","info":"Vérifie si le Raspberry est synchronisé via NTP.\n\nSi oui, met à jour le temps dans la puce RTC\nSi non, récupère le temps dans la puce RTC\n\n\nLes temps sont stockés dans la puce RTC en UTC (GMT).\n\n\nTODO : créer un node MCP79410","in":[{"x":100,"y":140,"wires":[{"id":"e07f3678.d16818"}]}],"out":[]},{"id":"906070fa.20c97","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"5d130117.f3019","type":"ui_tab","z":"","name":"Salle de Classe","icon":"dashboard","order":3},{"id":"f3474fa8.896f1","type":"ui_group","z":"","name":"Distance","tab":"5d130117.f3019","disp":true,"width":"6","collapse":true},{"id":"ab809e49.911b","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"97e32a06.7cf088","type":"ui_group","z":"","name":"Tension","tab":"96b2e298.16802","disp":true,"width":"6","collapse":false},{"id":"a05c3e49.282a","type":"ui_group","z":"","name":"Aleat_py","tab":"5d130117.f3019","disp":true,"width":"6","collapse":false},{"id":"720c0d32.d69db4","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":4},{"id":"50e597ba.47fea8","type":"ui_group","z":"","name":"Default","tab":"720c0d32.d69db4","disp":true,"width":"6","collapse":false},{"id":"64a4261d.9fbbc8","type":"ui_group","z":"","name":"Tesnion AC/DC","tab":"5d130117.f3019","disp":true,"width":"6","collapse":false},{"id":"eb8e25c7.d77d18","type":"serial-port","z":"","serialport":"/dev/ttyUSB1","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"5b91ca5f.6d2ed4","type":"ui_group","z":"","name":"USB","tab":"5d130117.f3019","disp":true,"width":"6","collapse":false},{"id":"96b2e298.16802","type":"ui_tab","z":"","name":"TEST","icon":"dashboard","order":5},{"id":"cfb7715f.01ed3","type":"ui_group","z":"","name":"PASCALINE","tab":"d5a26b3e.97c208","disp":true,"width":"16"},{"id":"d5a26b3e.97c208","type":"ui_tab","z":"","name":"PIERRON","icon":"dashboard","order":6},{"id":"26893409.4d91ac","type":"ui_tab","z":"","name":"ECHO","icon":"dashboard","order":7},{"id":"e26687f7.e85b28","type":"ui_group","z":"","name":"ECHO","tab":"26893409.4d91ac","disp":true,"width":"18","collapse":false},{"id":"7ea00345.1c56fc","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"c0960538.183098","type":"ui_tab","z":"","name":"Scanner","icon":"dashboard","order":8},{"id":"531c7c33.0e1d34","type":"ui_group","z":"","name":"Default","tab":"c0960538.183098","disp":true,"width":"6","collapse":false},{"id":"39947d89.a4a292","type":"ui_tab","z":"","name":"Conductivité","icon":"dashboard","order":9},{"id":"a9059374.ad2a6","type":"ui_group","z":"","name":"Gauges_histo","tab":"39947d89.a4a292","order":1,"disp":true,"width":"12","collapse":true},{"id":"87bf3e3b.607bb","type":"ui_group","z":"","name":"Tableau","tab":"39947d89.a4a292","order":2,"disp":true,"width":"12","collapse":true},{"id":"40b77b18.e03d54","type":"ui_group","z":"","name":"conductivite_params","tab":"39947d89.a4a292","order":3,"disp":true,"width":"6","collapse":true},{"id":"1313d17d.1f0b5f","type":"mqtt-broker","z":"131fa4e0.8bfc2b","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":"","willTopic":"","willQos":"0","willRetain":null,"willPayload":""},{"id":"1083b2f4.68551d","type":"ui_group","z":"131fa4e0.8bfc2b","name":"PID Controller For CPU Temperature of Raspberry Pi","tab":"c45280b4.09378","disp":true,"width":"9"},{"id":"c45280b4.09378","type":"ui_tab","z":"131fa4e0.8bfc2b","name":"Home","icon":"dashboard","order":10},{"id":"6c4c966a.032bd8","type":"ui_tab","z":"","name":"Système","icon":"system","order":11},{"id":"8d502567.8fd898","type":"ui_group","z":"","name":"CPU","tab":"6c4c966a.032bd8","disp":true,"width":"6","collapse":false},{"id":"f905f181.81a7a","type":"ui_tab","z":"","name":"Horloge","icon":"time","order":1},{"id":"2972450e.f7459a","type":"ui_group","z":"","name":"Horloge","tab":"f905f181.81a7a","disp":true,"width":"6","collapse":false},{"id":"9f3cb132.5bf42","type":"ui_group","z":"","name":"Système","tab":"6c4c966a.032bd8","disp":true,"width":"6","collapse":false},{"id":"7fdc0fdc.6c32e","type":"ui_group","z":"","name":"Chronomètre","tab":"f905f181.81a7a","disp":true,"width":"16","collapse":false},{"id":"559dc1df.0feca","type":"ui_tab","z":"","name":"Tension Douilles","icon":"dashboard","order":2},{"id":"de39c310.da8d8","type":"ui_group","z":"","name":"Douilles","tab":"559dc1df.0feca","disp":false,"width":"12","collapse":false},{"id":"2225cfda.709eb","type":"ui_group","z":"","name":"WIFI","tab":"6c4c966a.032bd8","disp":true,"width":"10","collapse":false},{"id":"ea8265c.1f87798","type":"ui_group","z":"","name":"LAN","tab":"6c4c966a.032bd8","disp":true,"width":"6","collapse":false},{"id":"7a064f42.55b7b","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"76db7324.a160fc","type":"ui_group","z":"","name":"Default","tab":"7a064f42.55b7b","disp":true,"width":"6","collapse":false},{"id":"ba6d06e2.e23b68","type":"mqtt in","z":"ba98b526.2cedf8","name":"","topic":"PIERRON/PI_NODE_TEST/tension","qos":"2","broker":"906070fa.20c97","x":200,"y":200,"wires":[["ed113652.dd8c28","2e41a031.1278a"]]},{"id":"27e3327a.c783fe","type":"ui_gauge","z":"ba98b526.2cedf8","name":"","group":"f3474fa8.896f1","order":0,"width":0,"height":0,"gtype":"gage","title":"tension AC","label":"Volt","format":"{{value|number:1}}V","min":"-100","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":790,"y":220,"wires":[]},{"id":"b80ea6ee.808328","type":"ui_chart","z":"ba98b526.2cedf8","name":"","group":"f3474fa8.896f1","order":0,"width":0,"height":0,"label":"Tension","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"","dot":false,"ymin":"-100","ymax":"100","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":780,"y":280,"wires":[[],[]]},{"id":"da337b8c.8c3de8","type":"ui_gauge","z":"ba98b526.2cedf8","name":"","group":"64a4261d.9fbbc8","order":0,"width":0,"height":0,"gtype":"gage","title":"tension AC/DC","label":"Volt","format":"{{value|number:1}}V","min":"0","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":780,"y":120,"wires":[]},{"id":"a4f68b06.85b778","type":"json","z":"9e82fc95.3172e","name":"","property":"payload","action":"","pretty":false,"x":210,"y":140,"wires":[["a81c49c5.ced538"]]},{"id":"a5df6c71.00d48","type":"function","z":"9e82fc95.3172e","name":"Voltmetre continu","func":"msg.payload = parseFloat(msg.payload);\nmsg.payload -= 0.5;\nmsg.payload *= 200;\n//msg.payload *=2;\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":120,"wires":[[]]},{"id":"4f455db8.012794","type":"change","z":"9e82fc95.3172e","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"payload.topic","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":180,"wires":[["a5df6c71.00d48"]]},{"id":"ed113652.dd8c28","type":"subflow:9e82fc95.3172e","z":"ba98b526.2cedf8","x":510,"y":240,"wires":[["b80ea6ee.808328","27e3327a.c783fe"]]},{"id":"a81c49c5.ced538","type":"function","z":"9e82fc95.3172e","name":"Switch mqtt/usb","func":"if (typeof(msg.payload )==\"object\"){\n    return [null,msg];\n}else{\n    return [msg,null];\n}\n","outputs":2,"noerr":0,"x":380,"y":140,"wires":[["a5df6c71.00d48"],["4f455db8.012794"]]},{"id":"c0b70de.0909bf","type":"json","z":"173a36e.62101c9","name":"","property":"payload","action":"","pretty":false,"x":190,"y":140,"wires":[["afae67c3.c36d58"]]},{"id":"92f3cadc.9e61f8","type":"function","z":"173a36e.62101c9","name":"Voltmetre alternatif","func":"msg.payload = parseFloat(msg.payload);\nmsg.payload *= 100;\n//msg.payload *=2;\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":120,"wires":[[]]},{"id":"624a879c.c5e998","type":"change","z":"173a36e.62101c9","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"payload.topic","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":180,"wires":[["92f3cadc.9e61f8"]]},{"id":"afae67c3.c36d58","type":"function","z":"173a36e.62101c9","name":"Switch mqtt/usb","func":"if (typeof(msg.payload )==\"object\"){\n    return [null,msg];\n}else{\n    return [msg,null];\n}\n","outputs":2,"noerr":0,"x":360,"y":140,"wires":[["92f3cadc.9e61f8"],["624a879c.c5e998"]]},{"id":"2e41a031.1278a","type":"subflow:173a36e.62101c9","z":"ba98b526.2cedf8","x":510,"y":160,"wires":[["da337b8c.8c3de8"]]},{"id":"c48b0006.12fb7","type":"serial in","z":"ba98b526.2cedf8","name":"USB_PIERRON","serial":"eb8e25c7.d77d18","x":140,"y":400,"wires":[["868df6ba.68c9f8"]]},{"id":"78595a2.a8a6ca4","type":"ui_gauge","z":"ba98b526.2cedf8","name":"","group":"5b91ca5f.6d2ed4","order":0,"width":0,"height":0,"gtype":"gage","title":"tension (usb)","label":"Volt","format":"{{value|number:1}}V","min":"-100","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":770,"y":400,"wires":[]},{"id":"868df6ba.68c9f8","type":"subflow:9e82fc95.3172e","z":"ba98b526.2cedf8","name":"","x":450,"y":400,"wires":[["78595a2.a8a6ca4"]]},{"id":"474c1866.37f0d8","type":"ui_text","z":"5b8c2051.dac96","group":"cfb7715f.01ed3","order":1,"width":0,"height":0,"name":"Résultat","label":"Résultat","format":"{{msg.payload}}","layout":"row-spread","x":960,"y":320,"wires":[]},{"id":"ce27831.4771b8","type":"ui_gauge","z":"5b8c2051.dac96","name":"","group":"cfb7715f.01ed3","order":4,"width":"3","height":"3","gtype":"gage","title":"Unités","label":"units","format":"{{value}}","min":"-9","max":"9","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1070,"y":540,"wires":[]},{"id":"8826dd9c.9f82b","type":"mqtt in","z":"5b8c2051.dac96","name":"","topic":"PIERRON/PI_NODE_TEST/ROT/10","qos":"2","broker":"906070fa.20c97","x":240,"y":340,"wires":[["d7b3a970.0ff7f8","650fd54e.5a6abc"]]},{"id":"ec08e6df.161e78","type":"mqtt in","z":"5b8c2051.dac96","name":"","topic":"PIERRON/PI_NODE_TEST/ROT/100","qos":"2","broker":"906070fa.20c97","x":230,"y":420,"wires":[["95455418.469648","fa30728c.4ec2a"]]},{"id":"38005021.39e1e","type":"mqtt in","z":"5b8c2051.dac96","name":"","topic":"PIERRON/PI_NODE_TEST/ROT/1","qos":"2","broker":"906070fa.20c97","x":240,"y":280,"wires":[["d5957da9.d046f","ff0d746b.6061e8"]]},{"id":"d5957da9.d046f","type":"function","z":"5b8c2051.dac96","name":"+/-1","func":"var compteur = flow.get(\"compteur\") || 0;\nmsg.payload = compteur + parseInt(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":280,"wires":[["49159710.2d56c8"]]},{"id":"d7b3a970.0ff7f8","type":"function","z":"5b8c2051.dac96","name":"+/-10","func":"var compteur = flow.get(\"compteur\") || 0;\nmsg.payload = compteur + 10*parseInt(msg.payload);\nflow.set(\"compteur\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":340,"wires":[["49159710.2d56c8"]]},{"id":"95455418.469648","type":"function","z":"5b8c2051.dac96","name":"+/-1000","func":"var compteur = flow.get(\"compteur\") || 0;\nmsg.payload = compteur + 100*parseInt(msg.payload);\nflow.set(\"compteur\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":420,"wires":[["49159710.2d56c8"]]},{"id":"ff0d746b.6061e8","type":"function","z":"5b8c2051.dac96","name":"unite +/- 1","func":"var unite = flow.get(\"unite\") || 0;\nmsg.payload = unite + parseInt(msg.payload);\nflow.set(\"unite\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":540,"wires":[["ce27831.4771b8","927ad209.566d2"]]},{"id":"65e0ca13.75da24","type":"inject","z":"5b8c2051.dac96","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":910,"y":500,"wires":[["ce27831.4771b8"]]},{"id":"927ad209.566d2","type":"trigger","z":"5b8c2051.dac96","op1":"","op2":"0","op1type":"nul","op2type":"num","duration":"3","extend":true,"units":"s","reset":"","bytopic":"all","name":"","x":740,"y":760,"wires":[["5155558f.8d92cc"]]},{"id":"5155558f.8d92cc","type":"function","z":"5b8c2051.dac96","name":"RAZ","func":"flow.set(\"unite\",0);\nflow.set(\"dizaine\",0);\nflow.set(\"centaine\",0);\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":760,"wires":[["ce27831.4771b8","5ed9a7c5.3c15b8","f6f7b9f5.759c28"]]},{"id":"5ed9a7c5.3c15b8","type":"ui_gauge","z":"5b8c2051.dac96","name":"","group":"cfb7715f.01ed3","order":3,"width":"3","height":"3","gtype":"gage","title":"dizaine","label":"units","format":"{{value}}","min":"-9","max":"9","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1080,"y":620,"wires":[]},{"id":"650fd54e.5a6abc","type":"function","z":"5b8c2051.dac96","name":"dizaine+/- 1","func":"var dizaine = flow.get(\"dizaine\") || 0;\nmsg.payload = dizaine + parseInt(msg.payload);\nflow.set(\"dizaine\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":620,"wires":[["5ed9a7c5.3c15b8","927ad209.566d2"]]},{"id":"c6ec7883.284718","type":"inject","z":"5b8c2051.dac96","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":910,"y":580,"wires":[["5ed9a7c5.3c15b8"]]},{"id":"f6f7b9f5.759c28","type":"ui_gauge","z":"5b8c2051.dac96","name":"","group":"cfb7715f.01ed3","order":2,"width":"3","height":"3","gtype":"gage","title":"centaine","label":"units","format":"{{value}}","min":"-9","max":"9","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1080,"y":700,"wires":[]},{"id":"fa30728c.4ec2a","type":"function","z":"5b8c2051.dac96","name":"unite +/- 1","func":"var centaine = flow.get(\"centaine\") || 0;\nmsg.payload = centaine + parseInt(msg.payload);\nflow.set(\"centaine\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":700,"wires":[["f6f7b9f5.759c28","927ad209.566d2"]]},{"id":"910b7699.1b2078","type":"inject","z":"5b8c2051.dac96","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":910,"y":660,"wires":[["f6f7b9f5.759c28"]]},{"id":"5fe8ec6c.547fa4","type":"ui_button","z":"5b8c2051.dac96","name":"","group":"cfb7715f.01ed3","order":0,"width":0,"height":0,"passthru":false,"label":"RAZ","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"num","topic":"","x":560,"y":200,"wires":[["49159710.2d56c8"]]},{"id":"49159710.2d56c8","type":"function","z":"5b8c2051.dac96","name":"","func":"flow.set(\"compteur\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":320,"wires":[["474c1866.37f0d8","8a54912e.d4378"]]},{"id":"8a54912e.d4378","type":"file in","z":"5b8c2051.dac96","name":"","filename":"/home/pi/.node-red/projects/PIANODE/click.wav","format":"","chunk":false,"sendError":false,"x":1020,"y":200,"wires":[["e6f120ff.a3d58"]]},{"id":"e6f120ff.a3d58","type":"ui_audio","z":"5b8c2051.dac96","name":"","group":"cfb7715f.01ed3","voice":"","always":true,"x":1220,"y":380,"wires":[]},{"id":"f2000009.07522","type":"serial in","z":"dad18347.47653","name":"","serial":"7ea00345.1c56fc","x":260,"y":300,"wires":[["4954047b.2d909c"]]},{"id":"4954047b.2d909c","type":"json","z":"dad18347.47653","name":"","property":"payload","action":"","pretty":false,"x":410,"y":300,"wires":[["384efbad.e00d24"]]},{"id":"9d3315d2.2ee608","type":"ui_gauge","z":"dad18347.47653","name":"","group":"e26687f7.e85b28","order":0,"width":0,"height":0,"gtype":"gage","title":"{{msg.topic}}","label":"mètres","format":"{{value|number:3}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":890,"y":260,"wires":[]},{"id":"1132a872.38b1b8","type":"ui_chart","z":"dad18347.47653","name":"","group":"e26687f7.e85b28","order":0,"width":0,"height":0,"label":"{{msg.topic}}","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"10","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":870,"y":440,"wires":[[],[]]},{"id":"a9aa9425.b6e138","type":"change","z":"dad18347.47653","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"payload.topic","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":300,"wires":[["9d3315d2.2ee608","1132a872.38b1b8","48b4d928.61cb48"]]},{"id":"384efbad.e00d24","type":"switch","z":"dad18347.47653","name":"","property":"payload.topic","propertyType":"msg","rules":[{"t":"eq","v":"distance","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":300,"wires":[["a9aa9425.b6e138"]]},{"id":"48b4d928.61cb48","type":"debug","z":"dad18347.47653","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":420,"y":500,"wires":[]},{"id":"c9ca2801.9698d8","type":"mqtt in","z":"b16f90ed.89548","name":"Températures","topic":"PIERRON/PI_33552/temperatures","qos":"2","broker":"906070fa.20c97","x":90,"y":80,"wires":[["12321455.b53a7c"]]},{"id":"d5ccfaae.1e0438","type":"mqtt in","z":"fa5172be.4a803","name":"","topic":"PIERRON/#","qos":"2","broker":"906070fa.20c97","x":110,"y":140,"wires":[["3d6010f0.d1c06"]]},{"id":"a643bcef.0f28a","type":"ui_button","z":"fa5172be.4a803","name":"","group":"531c7c33.0e1d34","order":0,"width":0,"height":0,"passthru":false,"label":"RAZ","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":550,"y":60,"wires":[["ed14af9c.a7e95"]]},{"id":"ed14af9c.a7e95","type":"change","z":"fa5172be.4a803","name":"","rules":[{"t":"set","p":"devices","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":100,"wires":[["aad96048.e783"]]},{"id":"ac231dab.f7123","type":"function","z":"fa5172be.4a803","name":"Populate flow.devices","func":"var devices = flow.get(\"devices\") || {};\nvar device = msg.topic.split('/').slice(0,2).join('/');\nif (! devices[device]){\n    devices[device]=\"mqtt\";\n    msg.payload = devices;\n    return msg;\n}","outputs":1,"noerr":0,"x":500,"y":140,"wires":[["ed14af9c.a7e95"]]},{"id":"aad96048.e783","type":"tableify","z":"fa5172be.4a803","name":"","before":"","after":"","tableStyle":"","theadStyle":"","tbodyStyle":"","trStyle":"","tdStyle":"","x":900,"y":100,"wires":[["2d57afc0.5647a"]]},{"id":"2d57afc0.5647a","type":"ui_template","z":"fa5172be.4a803","group":"531c7c33.0e1d34","name":"","order":0,"width":0,"height":0,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1060,"y":100,"wires":[[]]},{"id":"1b114981.e9b1e6","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":1,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":40,"wires":[]},{"id":"1d8fa1f4.b0561e","type":"split","z":"b16f90ed.89548","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":550,"y":80,"wires":[["91459b17.b4f048","2cd144.01661ebc"]]},{"id":"91459b17.b4f048","type":"switch","z":"b16f90ed.89548","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"T1","vt":"str"},{"t":"eq","v":"T2","vt":"str"},{"t":"eq","v":"T3","vt":"str"},{"t":"eq","v":"T4","vt":"str"},{"t":"eq","v":"T5","vt":"str"},{"t":"eq","v":"T6","vt":"str"},{"t":"eq","v":"T7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":690,"y":80,"wires":[["1b114981.e9b1e6"],["2b3484d.af66a7c"],["ab87b35d.c74c2"],["7c99e647.40f008"],["21f8e9c7.d0ea56"],["c43ddefb.6039"],["3edce5cd.37cc3a"]]},{"id":"35c0aa3.1d52c56","type":"json","z":"b16f90ed.89548","name":"","property":"payload","action":"","pretty":false,"x":410,"y":80,"wires":[["1d8fa1f4.b0561e","2d1c0bd3.4a81a4"]]},{"id":"2b3484d.af66a7c","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":2,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":80,"wires":[]},{"id":"ab87b35d.c74c2","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":3,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":120,"wires":[]},{"id":"2cd144.01661ebc","type":"ui_chart","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":4,"width":0,"height":0,"label":"Historique","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":840,"y":360,"wires":[[],[]]},{"id":"641fcf7d.c00d8","type":"tableify","z":"b16f90ed.89548","name":"Tableau","before":"","after":"","tableStyle":"","theadStyle":"","tbodyStyle":"","trStyle":"","tdStyle":"","x":640,"y":420,"wires":[["13c86856.c00768"]]},{"id":"4a8677f1.1626e8","type":"ui_template","z":"b16f90ed.89548","group":"87bf3e3b.607bb","name":"","order":8,"width":"12","height":"30","format":"pas de données","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":980,"y":420,"wires":[[]]},{"id":"93ab6f09.7292","type":"comment","z":"fa5172be.4a803","name":"Scan the Devices","info":"Scan for mqtt topic like \"PIERRON/DEVICE_NAME/#\"","x":150,"y":60,"wires":[]},{"id":"2d1c0bd3.4a81a4","type":"function","z":"b16f90ed.89548","name":"Add to flow.datas","func":"var moment = global.get('moment');\nmoment.locale('fr');\nvar datas = flow.get(\"datas\") || [];\nvar max_values = flow.get('max_values') || 1000;\nmsg.payload.date = moment().format(\"DD/MM/YYYY HH:mm:ss\");\ndatas.push(msg.payload);\nwhile (datas.length > max_values){\n    datas.shift();\n}\nflow.set(\"datas\", datas);\nmsg.payload = datas\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":420,"wires":[["641fcf7d.c00d8"]]},{"id":"3504e016.f0812","type":"ui_slider","z":"b16f90ed.89548","name":"","label":"","group":"40b77b18.e03d54","order":7,"width":0,"height":0,"passthru":false,"topic":"","min":0,"max":"1000","step":1,"x":270,"y":620,"wires":[["f74d6029.2a8eb","1293127f.94036e"]]},{"id":"f74d6029.2a8eb","type":"change","z":"b16f90ed.89548","name":"","rules":[{"t":"set","p":"max_values","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":620,"wires":[[]]},{"id":"3d6010f0.d1c06","type":"delay","z":"fa5172be.4a803","name":"","pauseType":"queue","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":290,"y":220,"wires":[["ac231dab.f7123"]]},{"id":"1293127f.94036e","type":"ui_text","z":"b16f90ed.89548","group":"40b77b18.e03d54","order":6,"width":0,"height":0,"name":"","label":"Nb de valeur maxi :","format":"{{msg.payload}}","layout":"row-spread","x":470,"y":660,"wires":[]},{"id":"13c86856.c00768","type":"change","z":"b16f90ed.89548","name":"msg.template","rules":[{"t":"set","p":"template","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":420,"wires":[["4a8677f1.1626e8"]]},{"id":"2e8e3dbb.2b6d32","type":"ui_button","z":"b16f90ed.89548","name":"","group":"40b77b18.e03d54","order":5,"width":0,"height":0,"passthru":false,"label":"RAZ","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":270,"y":520,"wires":[["fa0bc8d5.6cefb8","c85fcb42.645438"]]},{"id":"fa0bc8d5.6cefb8","type":"change","z":"b16f90ed.89548","name":"","rules":[{"t":"set","p":"datas","pt":"flow","to":"[]","tot":"json"},{"t":"set","p":"payload","pt":"msg","to":"datas","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":480,"wires":[["641fcf7d.c00d8"]]},{"id":"c85fcb42.645438","type":"change","z":"b16f90ed.89548","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":540,"wires":[["2cd144.01661ebc"]]},{"id":"12321455.b53a7c","type":"delay","z":"b16f90ed.89548","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":260,"y":80,"wires":[["35c0aa3.1d52c56"]]},{"id":"1232ed1c.83dcc3","type":"inject","z":"b16f90ed.89548","name":"","topic":"","payload":"max_values","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":230,"y":740,"wires":[["1293127f.94036e"]]},{"id":"8a6c7db1.a57ef","type":"inject","z":"131fa4e0.8bfc2b","name":"","topic":"","payload":"","payloadType":"num","repeat":"10","crontab":"","once":true,"onceDelay":"","x":130,"y":120,"wires":[["4d7f1d2b.1438c4"]]},{"id":"4d7f1d2b.1438c4","type":"exec","z":"131fa4e0.8bfc2b","command":"vcgencmd","addpay":false,"append":"measure_temp","useSpawn":"","timer":"","oldrc":false,"name":"getCPUtemp","x":298.6031188964844,"y":120.46029458727162,"wires":[["3af50510.a0c9ba"],[],[]]},{"id":"3af50510.a0c9ba","type":"function","z":"131fa4e0.8bfc2b","name":"CPU Temp Function","func":"//msg.payload = {'d':{'temp': parseFloat(msg.payload.replace(\"temp=\",\"\").replace(\"'C\\n\",\"\"))}};\nmsg.payload = parseFloat(msg.payload.replace(\"temp=\",\"\").replace(\"'C\\n\",\"\"));\nreturn msg;","outputs":1,"noerr":0,"x":506.19042205810547,"y":107.71432290758412,"wires":[["4972155b.d822cc","22aa53fd.55cb7c","2d18f1fc.918b1e"]]},{"id":"2e431a19.2ad5d6","type":"comment","z":"131fa4e0.8bfc2b","name":"Vérifie la température CPU","info":"","x":150,"y":40,"wires":[]},{"id":"4972155b.d822cc","type":"ui_gauge","z":"131fa4e0.8bfc2b","name":"","group":"8d502567.8fd898","order":0,"width":0,"height":0,"gtype":"gage","title":"Température CPU","label":"°C","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"60","seg2":"80","x":790,"y":80,"wires":[]},{"id":"22aa53fd.55cb7c","type":"ui_chart","z":"131fa4e0.8bfc2b","name":"","group":"8d502567.8fd898","order":0,"width":0,"height":0,"label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":750,"y":140,"wires":[[],[]]},{"id":"2d18f1fc.918b1e","type":"switch","z":"131fa4e0.8bfc2b","name":"> 80°C","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"80","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":220,"wires":[["b1d82181.dea01"]]},{"id":"4f70f7ff.4b9fd8","type":"ui_toast","z":"131fa4e0.8bfc2b","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"Système","name":"","x":1090,"y":160,"wires":[]},{"id":"b1d82181.dea01","type":"change","z":"131fa4e0.8bfc2b","name":"Alerte","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alerte Température CPU excessive.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":220,"wires":[["4f70f7ff.4b9fd8","8f63e471.905a88"]]},{"id":"8f63e471.905a88","type":"play audio","z":"131fa4e0.8bfc2b","name":"","voice":"8","x":1010,"y":260,"wires":[]},{"id":"bd8bcb6d.2e3138","type":"ui_ui_control","z":"131fa4e0.8bfc2b","name":"","x":780,"y":360,"wires":[["a2eb1697.478228"]]},{"id":"fcfe619d.1e878","type":"comment","z":"131fa4e0.8bfc2b","name":"Navigation entre onglets avec boutons","info":"Le LOCALHOST ne fonctionne pas!\n\nça devrait limiter au client local!","x":210,"y":260,"wires":[]},{"id":"90a205d6.12e7a8","type":"comment","z":"131fa4e0.8bfc2b","name":"Arret raspberry pi et gestion led","info":"","x":190,"y":520,"wires":[]},{"id":"88fdc000.a8ee2","type":"inject","z":"b16f90ed.89548","name":"","topic":"","payload":"INIT","payloadType":"str","repeat":"300","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":860,"wires":[["5afd7a91.eea884"]]},{"id":"5afd7a91.eea884","type":"mqtt out","z":"b16f90ed.89548","name":"","topic":"PIERRON/PI_33552/_WATCHDOG","qos":"","retain":"","broker":"906070fa.20c97","x":530,"y":860,"wires":[]},{"id":"3edce5cd.37cc3a","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":3,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":280,"wires":[]},{"id":"c43ddefb.6039","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":3,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":240,"wires":[]},{"id":"21f8e9c7.d0ea56","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":3,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":200,"wires":[]},{"id":"7c99e647.40f008","type":"ui_gauge","z":"b16f90ed.89548","name":"","group":"a9059374.ad2a6","order":3,"width":"4","height":"4","gtype":"gage","title":"{{topic}}","label":"°C","format":"{{value|number:1}}","min":0,"max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":930,"y":160,"wires":[]},{"id":"9f9d9ebc.40ba6","type":"i2c in","z":"24caa50b.e874ba","name":"MCP79410_RTC","address":"111","command":"0","count":"7","x":590,"y":160,"wires":[["6fff0f49.e2f1b"]]},{"id":"43fae624.367668","type":"i2c out","z":"24caa50b.e874ba","name":"MCP79410_RTC","address":"111","command":"0","payload":"payload","payloadType":"msg","count":"7","x":810,"y":100,"wires":[]},{"id":"6c62e8d3.7eb808","type":"debug","z":"24caa50b.e874ba","name":"Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1410,"y":160,"wires":[]},{"id":"6fff0f49.e2f1b","type":"function","z":"24caa50b.e874ba","name":"Decode MCP79410","func":"//\n// En entrée : tableau des 7 1ers registres du MCP79410\n//  la date y est stockée en UTC\n// En sortie : \n//      - msg.payload : timestamp lu\n//      - msg.rtc : détail ses champs\n//      - msg.UTCDate : string Date UTC\n//      - msg.LocaleDate : String locale date\n\nvar rtc = {}\nrtc.SECTEN = (msg.payload[0] & 112) >> 4; //01110000b\nrtc.SECONE = msg.payload[0] & 15; //00001111b\nrtc.MINTEN = (msg.payload[1] & 112) >> 4; //01110000b\nrtc.MINONE = msg.payload[1] & 15; //00001111b\nrtc.HR12_24 = (msg.payload[2] & 64) >> 6 ; //01000000b\nif (rtc.HR_12_24 == 1){ // Format 12H\n    rtc.AM_PM = (msg.payload[2] & 16) >> 4;\n    rtc.HRTEN = (msg.payload[2] & 8) >> 3;\n}else{ // Format 24H\n    rtc.HRTEN = (msg.payload[2] & 48) >> 4;\n}\nrtc.HRONE = (msg.payload[2] & 7);\nrtc.OSCRUN  = (msg.payload[3] & 32) >> 5;\nrtc.PWRFAIL = (msg.payload[3] & 16) >> 4;\nrtc.VBATEN = (msg.payload[3] & 8) >> 3;\nrtc.WKDAY = (msg.payload[3] & 7);\nrtc.DATETEN = (msg.payload[4] & 48) >> 4; \nrtc.DATEONE = (msg.payload[4] & 15); \nrtc.LPYR = (msg.payload[5] & 32) >> 5; \nrtc.MTHTEN = (msg.payload[5] & 16) >> 4; \nrtc.MTHONE = (msg.payload[5] & 15);\nrtc.YRTEN = (msg.payload[6] & 240) >> 4; \nrtc.YRONE = (msg.payload[6] & 15); \n//ATTENTION BUG DE L'AN 2100!\nvar siecle = 20;\n// La date est stockée en UTC dans le MCP79410\nrtc.date = new Date( Date.UTC(\n    siecle*100 + rtc.YRTEN*10 + rtc.YRONE,\n    rtc.MTHTEN*10 + rtc.MTHONE,\n    rtc.DATETEN*10 + rtc.DATEONE,\n    rtc.HRTEN*10 + rtc.HRONE,\n    rtc.MINTEN*10 + rtc.MINONE,\n    rtc.SECTEN*10 + rtc.SECONE))\nmsg.rtc = rtc;\nmsg.UTCDate = rtc.date.toUTCString();\nmsg.LocaleDate = rtc.date.toLocaleString();\nmsg.payload = rtc.date.getTime();\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":160,"wires":[["d4427d7a.2f98a"]]},{"id":"303da35e.39e04c","type":"function","z":"24caa50b.e874ba","name":"Encode MCP79410","func":"//\n// En entrée : la date à enregistrer dans le MCP79410\n//  la date est stockée en UTC\n// En sortie : \n//      - msg.payload : à envoyer via i2C\n//      - msg.rtc : détail ses champs\n\nvar rtc = {}\nvar date = new Date(msg.payload);\nmsg.payload=[];\n\nrtc.SECTEN = Math.floor(date.getUTCSeconds()/10);\nrtc.SECONE = date.getUTCSeconds()%10;\nrtc.MINTEN = Math.floor(date.getUTCMinutes()/10);\nrtc.MINONE = date.getUTCMinutes()%10;\nrtc.HR12_24 = 0;\nrtc.HRTEN = Math.floor(date.getUTCHours()/10);\nrtc.HRONE = date.getUTCHours()%10;\nrtc.WKDAY = date.getUTCDay();\nrtc.DATETEN = Math.floor(date.getUTCDate()/10);\nrtc.DATEONE = date.getUTCDate()%10;\nrtc.MTHTEN = Math.floor(date.getUTCMonth()/10);\nrtc.MTHONE = date.getUTCMonth()%10;\nrtc.YRTEN = Math.floor(date.getUTCFullYear()%100/10);\nrtc.YRONE = date.getUTCFullYear()%10;\n\nmsg.payload[0] = 128 + (rtc.SECTEN << 4) + rtc.SECONE;\nmsg.payload[1] = (rtc.MINTEN << 4) + rtc.MINONE;\nmsg.payload[2] = (rtc.HR12_24 << 6) + (rtc.HRTEN << 4) + rtc.HRONE;\nmsg.payload[3] = rtc.WKDAY;\nmsg.payload[4] = (rtc.DATETEN << 4) + rtc.DATEONE;\nmsg.payload[5] = (rtc.MTHTEN << 4) + rtc.MTHONE;\nmsg.payload[6] = (rtc.YRTEN << 4) + rtc.YRONE;\n\nmsg.rtc = rtc;\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":100,"wires":[["43fae624.367668"]]},{"id":"b6f2bc18.16973","type":"exec","z":"24caa50b.e874ba","command":"sudo date -u ","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1250,"y":160,"wires":[[],["6c62e8d3.7eb808"],[]]},{"id":"d4427d7a.2f98a","type":"moment","z":"24caa50b.e874ba","name":"","topic":"","input":"payload","inputType":"msg","inTz":"ETC/GMT","adjAmount":0,"adjType":"days","adjDir":"add","format":"MMDDHHmmYYYY.ss","locale":"fr_FR","output":"","outputType":"msg","outTz":"Europe/Paris","x":1040,"y":160,"wires":[["b6f2bc18.16973"]]},{"id":"e07f3678.d16818","type":"exec","z":"24caa50b.e874ba","command":"timedatectl","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":250,"y":140,"wires":[["46dbcc9a.47dc94"],[],[]]},{"id":"84153c64.20dd7","type":"inject","z":"dbf47c6d.710ab","name":"Auto","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":true,"onceDelay":0.1,"x":310,"y":40,"wires":[["fe1e0993.269768"]]},{"id":"46dbcc9a.47dc94","type":"switch","z":"24caa50b.e874ba","name":"","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"Network time on: yes","vt":"str","case":false},{"t":"regex","v":"Network time on: no","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":140,"wires":[["303da35e.39e04c"],["9f9d9ebc.40ba6"]],"outputLabels":["NTP ok","NTP down"]},{"id":"fe1e0993.269768","type":"subflow:24caa50b.e874ba","z":"dbf47c6d.710ab","name":"NTP<=>RTC","x":510,"y":40,"wires":[]},{"id":"7c87613.94c34a","type":"inject","z":"dbf47c6d.710ab","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":330,"y":120,"wires":[["72924d85.0bb134","3ed825d9.c5108a"]]},{"id":"72924d85.0bb134","type":"moment","z":"dbf47c6d.710ab","name":"LL","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Paris","adjAmount":0,"adjType":"days","adjDir":"add","format":"LL","locale":"fr_FR","output":"","outputType":"msg","outTz":"Europe/Paris","x":590,"y":100,"wires":[["2ab145e4.766a4a"]]},{"id":"eb655bb1.3740b8","type":"rpi-gpio in","z":"131fa4e0.8bfc2b","name":"S2_rouge","pin":"13","intype":"tri","debounce":"25","read":false,"x":140,"y":320,"wires":[["21813958.c284d6"]]},{"id":"716a10bb.00eec","type":"rpi-gpio in","z":"131fa4e0.8bfc2b","name":"S1_jaune","pin":"15","intype":"tri","debounce":"25","read":false,"x":140,"y":400,"wires":[["e7563aa8.f50908"]]},{"id":"a72a9549.794c48","type":"change","z":"131fa4e0.8bfc2b","name":"+1","rules":[{"t":"set","p":"payload","pt":"msg","to":"+1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":320,"wires":[["791b6da6.1daa44"]]},{"id":"283ccd20.ab3ac2","type":"change","z":"131fa4e0.8bfc2b","name":"-1","rules":[{"t":"set","p":"payload","pt":"msg","to":"-1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":400,"wires":[["791b6da6.1daa44"]]},{"id":"21813958.c284d6","type":"switch","z":"131fa4e0.8bfc2b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":320,"wires":[["a72a9549.794c48"]]},{"id":"e7563aa8.f50908","type":"switch","z":"131fa4e0.8bfc2b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":400,"wires":[["283ccd20.ab3ac2"]]},{"id":"6c07c917.ac35c8","type":"inject","z":"131fa4e0.8bfc2b","name":"","topic":"","payload":"100","payloadType":"num","repeat":"1","crontab":"","once":true,"onceDelay":"1","x":150,"y":600,"wires":[["9d36efbc.d42ff"]]},{"id":"2d572e03.b4c932","type":"rpi-gpio in","z":"131fa4e0.8bfc2b","name":"S4_vert","pin":"11","intype":"tri","debounce":"25","read":false,"x":130,"y":700,"wires":[["c9999211.9541","d9498608.6f4988"]]},{"id":"c9999211.9541","type":"trigger","z":"131fa4e0.8bfc2b","op1":"","op2":"50","op1type":"nul","op2type":"num","duration":"3","extend":false,"units":"s","reset":"1","bytopic":"all","name":"","x":280,"y":700,"wires":[["9d36efbc.d42ff","4dc4f85f.74fd88","240434f6.d05d9c","f3f2e7ca.893148"]]},{"id":"2cae3d08.0bb012","type":"exec","z":"131fa4e0.8bfc2b","command":"sudo shutdown -h now","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Shutdown","x":600,"y":700,"wires":[[],[],[]]},{"id":"9d36efbc.d42ff","type":"rpi-gpio out","z":"131fa4e0.8bfc2b","name":"PWM LED2","pin":"7","set":false,"level":"0","freq":"2","out":"pwm","x":450,"y":600,"wires":[]},{"id":"4dc4f85f.74fd88","type":"delay","z":"131fa4e0.8bfc2b","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":700,"wires":[["2cae3d08.0bb012"]]},{"id":"4b1bf002.6f31","type":"ui_toast","z":"131fa4e0.8bfc2b","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"PIANODE","name":"","x":670,"y":780,"wires":[]},{"id":"240434f6.d05d9c","type":"change","z":"131fa4e0.8bfc2b","name":"Arrêt en cours.....","rules":[{"t":"set","p":"payload","pt":"msg","to":"Arrêt en cours.....","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":780,"wires":[["4b1bf002.6f31"]]},{"id":"c69322d6.0c654","type":"ui_button","z":"131fa4e0.8bfc2b","name":"Reboot","group":"9f3cb132.5bf42","order":0,"width":0,"height":0,"passthru":false,"label":"Reboot","color":"green","bgcolor":"pink","icon":"fa-circle","payload":"sudo reboot","payloadType":"str","topic":"","x":380,"y":920,"wires":[["c3738c0.ff5a77"]]},{"id":"8cb6bbd3.ac2b48","type":"ui_button","z":"131fa4e0.8bfc2b","name":"Shutdown","group":"9f3cb132.5bf42","order":0,"width":0,"height":0,"passthru":false,"label":"(long) Arrête le système","color":"green","bgcolor":"pink","icon":"fa-circle","payload":"sudo shutdown -h now","payloadType":"str","topic":"","x":380,"y":960,"wires":[["c3738c0.ff5a77"]]},{"id":"c3738c0.ff5a77","type":"exec","z":"131fa4e0.8bfc2b","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":770,"y":900,"wires":[[],[],[]]},{"id":"59cdb40f.5e266c","type":"ui_button","z":"dbf47c6d.710ab","name":"","group":"7fdc0fdc.6c32e","order":0,"width":"0","height":"0","passthru":false,"label":"{{msg.label}}","color":"green","bgcolor":"white","icon":"fa-circle","payload":"START","payloadType":"str","topic":"","x":430,"y":380,"wires":[["b6c5af48.a9eb3"]]},{"id":"eb5a251.e363fd8","type":"rpi-gpio in","z":"dbf47c6d.710ab","name":"S4_vert","pin":"11","intype":"tri","debounce":"25","read":false,"x":90,"y":500,"wires":[["85b330ef.c06ce"]]},{"id":"488a6d2a.65e1a4","type":"rpi-gpio in","z":"dbf47c6d.710ab","name":"S3_bleu","pin":"12","intype":"tri","debounce":"25","read":false,"x":100,"y":560,"wires":[["d7fcdc34.4bc9f"]]},{"id":"80a8db46.3c9308","type":"ui_button","z":"dbf47c6d.710ab","name":"","group":"7fdc0fdc.6c32e","order":0,"width":0,"height":0,"passthru":false,"label":"RAZ","color":"blue","bgcolor":"white","icon":"fa-circle","payload":"STOP","payloadType":"str","topic":"","x":430,"y":620,"wires":[["fd0ec05d.f1892"]]},{"id":"50d9e285.71c4fc","type":"inject","z":"dbf47c6d.710ab","name":"@start","topic":"","payload":"STOP","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":300,"wires":[["29ce95e7.def7ea","c861119b.1fb6d"]]},{"id":"29ce95e7.def7ea","type":"change","z":"dbf47c6d.710ab","name":"Init","rules":[{"t":"set","p":"CHRONO_STATUS","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"00:00:00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":300,"wires":[["65073fde.d93bb"]]},{"id":"b6c5af48.a9eb3","type":"function","z":"dbf47c6d.710ab","name":"Init","func":"var now = new Date();\nvar msgs = [null,null];\n\nif(flow.get(\"CHRONO_STATUS\")==\"STOP\"){\n    flow.set(\"CHRONO_STATUS\",\"RUN\");  \n    flow.set(\"CHRONO_TIME_START\",now - (flow.get(\"CHRONO_TIME_ELAPSED\")||0));\n    msgs[0] = msg;\n}else{\n    flow.set(\"CHRONO_STATUS\",\"STOP\");\n    flow.set(\"CHRONO_TIME_ELAPSED\",\n        now - flow.get(\"CHRONO_TIME_START\"));\n    msg.reset = true;\n    msgs[1] = msg;\n}\n\n\nreturn msgs;","outputs":2,"noerr":0,"x":570,"y":420,"wires":[["b9572748.6b47a8","154e1814.68b1d8"],["c861119b.1fb6d"]],"outputLabels":["START","STOP"]},{"id":"b9572748.6b47a8","type":"function","z":"dbf47c6d.710ab","name":"Calc duration","func":"var moment = global.get(\"moment\");\nvar now = new Date();\n\nvar temps = moment.duration(now-flow.get(\"CHRONO_TIME_START\"));\n\nmsg.payload = temps.hours().toLocaleString('fr-FR', {minimumIntegerDigits: 2})+\n            \":\"+temps.minutes().toLocaleString('fr-FR', {minimumIntegerDigits: 2})+\n            \":\"+temps.seconds().toLocaleString('fr-FR', {minimumIntegerDigits: 2});\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":420,"wires":[["70e1173b.222ec8","65073fde.d93bb"]]},{"id":"70e1173b.222ec8","type":"delay","z":"dbf47c6d.710ab","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":540,"wires":[["31e2315f.ee676e"]]},{"id":"fd0ec05d.f1892","type":"function","z":"dbf47c6d.710ab","name":"RAZ","func":"var now = new Date();\n\nflow.set(\"CHRONO_TIME_START\",now);\nflow.set(\"CHRONO_TIME_ELAPSED\", 0);\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":560,"wires":[["b9572748.6b47a8"]]},{"id":"154e1814.68b1d8","type":"change","z":"dbf47c6d.710ab","name":"PAUSE","rules":[{"t":"set","p":"label","pt":"msg","to":"STOP-PAUSE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":420,"wires":[["59cdb40f.5e266c"]]},{"id":"c861119b.1fb6d","type":"change","z":"dbf47c6d.710ab","name":"START","rules":[{"t":"set","p":"label","pt":"msg","to":"START","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":380,"wires":[["59cdb40f.5e266c"]]},{"id":"31e2315f.ee676e","type":"switch","z":"dbf47c6d.710ab","name":"RUN","property":"CHRONO_STATUS","propertyType":"flow","rules":[{"t":"eq","v":"RUN","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":910,"y":540,"wires":[["b9572748.6b47a8"]]},{"id":"4b4585ec.e6725c","type":"delay","z":"16883ec7.5e17a1","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":860,"y":200,"wires":[["e7d69911.184c48"]]},{"id":"d2bd84a.39da678","type":"ui_audio","z":"16883ec7.5e17a1","name":"","group":"f3474fa8.896f1","voice":"fr-FR","always":true,"x":1240,"y":200,"wires":[]},{"id":"47dc8303.2073cc","type":"switch","z":"16883ec7.5e17a1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":200,"wires":[["4b4585ec.e6725c"]]},{"id":"e7d69911.184c48","type":"change","z":"16883ec7.5e17a1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alerte Tension maximum atteinte.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":200,"wires":[["d2bd84a.39da678"]]},{"id":"ac20b49c.5209e8","type":"ui_gauge","z":"16883ec7.5e17a1","name":"","group":"de39c310.da8d8","order":0,"width":"12","height":"8","gtype":"gage","title":"Tension ","label":"Volts","format":"{{value|number:1}}","min":0,"max":"5","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":700,"y":120,"wires":[]},{"id":"671463f.8a42e9c","type":"Tension Douilles","z":"16883ec7.5e17a1","name":"","timer":"0.1","no_change_timer":"5","precision":"0.1","topic":"","x":240,"y":200,"wires":[["47dc8303.2073cc","ac20b49c.5209e8","179510d.eb3c0ef","5e494ef7.6182a","cd17d1af.6ebdf"]]},{"id":"b22e8a76.018598","type":"comment","z":"dbf47c6d.710ab","name":"Horloge temps réel","info":"Vérifie si le Raspberry est synchronisé via NTP.\n\nSi oui, met à jour le temps dans la puce RTC Si non, récupère le temps dans la puce RTC\n\nLes temps sont stockés dans la puce RTC en UTC (GMT).\n\n\n    ","x":110,"y":40,"wires":[]},{"id":"3ed825d9.c5108a","type":"moment","z":"dbf47c6d.710ab","name":"LT","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Paris","adjAmount":0,"adjType":"days","adjDir":"add","format":"LT","locale":"fr_FR","output":"","outputType":"msg","outTz":"Europe/Paris","x":590,"y":160,"wires":[["e3334b3c.4b1318"]]},{"id":"e3334b3c.4b1318","type":"ui_template","z":"dbf47c6d.710ab","group":"2972450e.f7459a","name":"Heure","order":0,"width":"5","height":"3","format":"<div style=\"font-size:100px\">{{msg.payload}}</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":930,"y":160,"wires":[[]]},{"id":"2ab145e4.766a4a","type":"ui_template","z":"dbf47c6d.710ab","group":"2972450e.f7459a","name":"Date","order":0,"width":"6","height":"3","format":"<div style=\"font-size:50px\">{{msg.payload}}</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":930,"y":100,"wires":[[]]},{"id":"65073fde.d93bb","type":"ui_template","z":"dbf47c6d.710ab","group":"7fdc0fdc.6c32e","name":"Chrono","order":0,"width":"16","height":"6","format":"<div style=\"font-size:200px\">{{msg.payload}}</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":420,"wires":[[]]},{"id":"abe6642c.3d3af8","type":"comment","z":"dbf47c6d.710ab","name":"Affichage Date et Heure","info":"","x":120,"y":120,"wires":[]},{"id":"7f0a6d33.e4fb74","type":"comment","z":"dbf47c6d.710ab","name":"Chronometre","info":"Entrées :\n- Soit bouton Interface (souris)\n- Soit bouton S3 et S4","x":90,"y":240,"wires":[]},{"id":"f9f7b221.1ffbe","type":"change","z":"131fa4e0.8bfc2b","name":"","rules":[{"t":"set","p":"LOCAL_UI_TAB","pt":"global","to":"name","tot":"msg"},{"t":"set","p":"LOCALHOST","pt":"global","to":"socketip","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":360,"wires":[[]]},{"id":"a2eb1697.478228","type":"switch","z":"131fa4e0.8bfc2b","name":"Localhost","property":"socketip","propertyType":"msg","rules":[{"t":"eq","v":"IP_LAN","vt":"global"},{"t":"eq","v":"IP_WLAN","vt":"global"}],"checkall":"false","repair":false,"outputs":2,"x":940,"y":360,"wires":[["f9f7b221.1ffbe"],["f9f7b221.1ffbe"]]},{"id":"d7fcdc34.4bc9f","type":"function","z":"dbf47c6d.710ab","name":"LOCAL_TAB==\"Horloge\"","func":"var local_tab = global.get(\"LOCAL_UI_TAB\") || \"none\";\nif ((msg.payload == 0) && (local_tab==\"Horloge\")){\n    return msg;\n}","outputs":1,"noerr":0,"x":290,"y":560,"wires":[["fd0ec05d.f1892"]]},{"id":"85b330ef.c06ce","type":"function","z":"dbf47c6d.710ab","name":"LOCAL_TAB==\"Horloge\"","func":"var local_tab = global.get(\"LOCAL_UI_TAB\") || \"none\";\nif ((msg.payload == 0) && (local_tab==\"Horloge\")){\n    return msg;\n}","outputs":1,"noerr":0,"x":290,"y":500,"wires":[["b6c5af48.a9eb3"]]},{"id":"179510d.eb3c0ef","type":"ui_chart","z":"16883ec7.5e17a1","name":"","group":"de39c310.da8d8","order":0,"width":0,"height":0,"label":"Tension","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"5","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":700,"y":260,"wires":[[],[]]},{"id":"2a1e0755.620368","type":"comment","z":"131fa4e0.8bfc2b","name":"Affichage Info réseau","info":"","x":160,"y":1000,"wires":[]},{"id":"bb33f35a.cd162","type":"ui_template","z":"131fa4e0.8bfc2b","group":"2225cfda.709eb","name":"Hotspot","order":0,"width":0,"height":0,"format":"<p>Hotspot WIFI: \n<a href=\"http://{{msg.payload}}\" >http://{{msg.payload}}</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":1060,"wires":[[]]},{"id":"800b530.cb0acb","type":"exec","z":"131fa4e0.8bfc2b","command":"ifdata -pa wlan0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":640,"y":1080,"wires":[["64d717a3.00ce88"],[],[]]},{"id":"2e78ba71.693ec6","type":"inject","z":"131fa4e0.8bfc2b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"2","x":150,"y":1080,"wires":[["800b530.cb0acb","4113de51.86ff8"]]},{"id":"3b167298.1fed2e","type":"ui_template","z":"131fa4e0.8bfc2b","group":"2225cfda.709eb","name":"PIANODE UI","order":0,"width":0,"height":0,"format":"<p>PIANODE UI: \n<a href=\"http://{{msg.payload}}:1880/ui\" >http://{{msg.payload}}:1880/ui</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1010,"y":1100,"wires":[[]]},{"id":"b3f68fb4.22f95","type":"ui_template","z":"131fa4e0.8bfc2b","group":"2225cfda.709eb","name":"NodeRed","order":0,"width":0,"height":0,"format":"<p>PIANODE CONFIG: \n<a href=\"http://{{msg.payload}}:1880\" >http://{{msg.payload}}:1880</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":1140,"wires":[[]]},{"id":"966af08a.7843a","type":"ui_template","z":"131fa4e0.8bfc2b","group":"ea8265c.1f87798","name":"Hotspot","order":0,"width":0,"height":0,"format":"<p>Hotspot WIFI: \n<a href=\"http://{{msg.payload}}\" >http://{{msg.payload}}</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":1240,"wires":[[]]},{"id":"4113de51.86ff8","type":"exec","z":"131fa4e0.8bfc2b","command":"ifdata -pa eth0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":640,"y":1240,"wires":[["bb1bde4a.2387"],[],[]]},{"id":"6bcb6779.e3beb8","type":"ui_template","z":"131fa4e0.8bfc2b","group":"ea8265c.1f87798","name":"PIANODE UI","order":0,"width":0,"height":0,"format":"<p>PIANODE UI: \n<a href=\"http://{{msg.payload}}:1880/ui\" >http://{{msg.payload}}:1880/ui</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1010,"y":1280,"wires":[[]]},{"id":"1d1671db.2d344e","type":"ui_template","z":"131fa4e0.8bfc2b","group":"ea8265c.1f87798","name":"NodeRed","order":0,"width":0,"height":0,"format":"<p>PIANODE CONFIG: \n<a href=\"http://{{msg.payload}}:1880\" >http://{{msg.payload}}:1880</a>\n</p>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1000,"y":1320,"wires":[[]]},{"id":"3450d2a6.70d26e","type":"ui_button","z":"131fa4e0.8bfc2b","name":"","group":"ea8265c.1f87798","order":0,"width":0,"height":0,"passthru":false,"label":"Rafraichir","color":"blue","bgcolor":"pink","icon":"fa-circle","payload":"","payloadType":"str","topic":"","x":150,"y":1200,"wires":[["800b530.cb0acb","4113de51.86ff8"]]},{"id":"6e602e03.8cbeb","type":"rpi-gpio in","z":"131fa4e0.8bfc2b","name":"S3_bleu","pin":"12","intype":"tri","debounce":"25","read":false,"x":80,"y":1320,"wires":[["938a86d6.b16958"]]},{"id":"938a86d6.b16958","type":"function","z":"131fa4e0.8bfc2b","name":"LOCAL_TAB==\"System\"","func":"var local_tab = global.get(\"LOCAL_UI_TAB\") || \"none\";\nif ((msg.payload == 0) && (local_tab==\"Système\")){\n    return msg;\n}","outputs":1,"noerr":0,"x":290,"y":1320,"wires":[["800b530.cb0acb","4113de51.86ff8"]]},{"id":"d9498608.6f4988","type":"function","z":"131fa4e0.8bfc2b","name":"LOCAL_TAB==\"System\"","func":"var local_tab = global.get(\"LOCAL_UI_TAB\") || \"none\";\nif ((msg.payload === 0) && (local_tab==\"Système\")){\n    return msg;\n}","outputs":1,"noerr":0,"x":270,"y":860,"wires":[["efa1eacc.6e1398"]]},{"id":"efa1eacc.6e1398","type":"trigger","z":"131fa4e0.8bfc2b","op1":"1","op2":"sudo reboot","op1type":"str","op2type":"str","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":560,"y":860,"wires":[["c3738c0.ff5a77"]]},{"id":"f3f2e7ca.893148","type":"change","z":"131fa4e0.8bfc2b","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":820,"wires":[["efa1eacc.6e1398"]]},{"id":"2016080.c334cf8","type":"change","z":"131fa4e0.8bfc2b","name":"","rules":[{"t":"set","p":"IP_WLAN","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":1020,"wires":[[]]},{"id":"8cabdb15.694c78","type":"change","z":"131fa4e0.8bfc2b","name":"","rules":[{"t":"set","p":"IP_LAN","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1200,"wires":[[]]},{"id":"791b6da6.1daa44","type":"change","z":"131fa4e0.8bfc2b","name":"LOCALHOST","rules":[{"t":"set","p":"socketip","pt":"msg","to":"LOCALHOST","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":360,"wires":[["bd8bcb6d.2e3138"]]},{"id":"64d717a3.00ce88","type":"function","z":"131fa4e0.8bfc2b","name":"clean","func":"msg.payload = msg.payload.substring(0,msg.payload.length-1);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":1060,"wires":[["2016080.c334cf8","bb33f35a.cd162","3b167298.1fed2e","b3f68fb4.22f95"]]},{"id":"bb1bde4a.2387","type":"function","z":"131fa4e0.8bfc2b","name":"clean","func":"msg.payload = msg.payload.substring(0,msg.payload.length-1);\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":1220,"wires":[["8cabdb15.694c78","966af08a.7843a","6bcb6779.e3beb8","1d1671db.2d344e"]]},{"id":"5c35425b.5debcc","type":"rpi-gpio in","z":"16883ec7.5e17a1","name":"S3_bleu","pin":"12","intype":"tri","debounce":"25","read":false,"x":100,"y":360,"wires":[["4c1ac5ff.44d6ac"]]},{"id":"4c1ac5ff.44d6ac","type":"function","z":"16883ec7.5e17a1","name":"LOCAL_TAB==\"Tension Douilles\"","func":"var local_tab = global.get(\"LOCAL_UI_TAB\") || \"none\";\nif ((msg.payload == 0) && (local_tab==\"Tension Douilles\")){\n    return msg;\n}","outputs":1,"noerr":0,"x":320,"y":360,"wires":[["1143398e.0594c6"]]},{"id":"1143398e.0594c6","type":"change","z":"16883ec7.5e17a1","name":"[]","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":360,"wires":[["179510d.eb3c0ef"]]},{"id":"cab7fa2b.8b65c8","type":"ui_button","z":"16883ec7.5e17a1","name":"","group":"de39c310.da8d8","order":0,"width":0,"height":0,"passthru":false,"label":"RAZ","color":"blue","bgcolor":"pink","icon":"fa-circle","payload":"[]","payloadType":"json","topic":"","x":290,"y":280,"wires":[["179510d.eb3c0ef"]]},{"id":"5e494ef7.6182a","type":"ui_template","z":"16883ec7.5e17a1","group":"de39c310.da8d8","name":"Voltage","order":0,"width":"0","height":"0","format":"<div style=\"font-size:500px\">{{msg.payload|number:1}}V</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":840,"y":420,"wires":[[]]},{"id":"cd17d1af.6ebdf","type":"ui_gauge","z":"16883ec7.5e17a1","name":"","group":"76db7324.a160fc","order":0,"width":0,"height":0,"gtype":"gage","title":"gauge","label":"°C","format":"{{value}}","min":0,"max":"5","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":730,"y":520,"wires":[]}]